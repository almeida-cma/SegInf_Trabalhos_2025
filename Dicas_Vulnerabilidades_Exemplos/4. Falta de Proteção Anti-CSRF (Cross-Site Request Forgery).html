<!DOCTYPE html>
<html>
<head>
    <title>Simula√ß√£o: Falta de Prote√ß√£o Anti-CSRF</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-area {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin: 5px;
        }
        .vulnerable {
            background-color: #ffdddd;
            border-left: 5px solid #f44336;
            padding: 10px;
        }
        .secure {
            background-color: #ddffdd;
            border-left: 5px solid #4CAF50;
            padding: 10px;
        }
        iframe {
            width: 100%;
            height: 200px;
            border: 1px solid #999;
            margin: 10px 0;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 120px;
        }
        input[type="text"] {
            padding: 8px;
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>Simula√ß√£o: Falta de Prote√ß√£o Anti-CSRF</h1>
    
    <div class="vulnerable">
        <h2>‚ùå Cen√°rio Vulner√°vel (Sem Tokens CSRF)</h2>
        <p>Neste cen√°rio, um site malicioso pode fazer requisi√ß√µes autenticadas em nome do usu√°rio.</p>
        
        <div class="demo-area">
            <h3>Demonstra√ß√£o:</h3>
            
            <p>1. Suponha que voc√™ est√° logado em um site banc√°rio (simulado abaixo):</p>
            <div class="form-group">
                <label>Conta Banc√°ria:</label>
                <input type="text" id="bankAccount" value="12345-6" readonly>
            </div>
            <div class="form-group">
                <label>Saldo:</label>
                <input type="text" id="balance" value="R$ 5.000,00" readonly>
            </div>
            <button onclick="simulateLogin()">Simular Login</button>
            
            <p>2. Agora voc√™ visita um site malicioso que cont√©m este iframe:</p>
            <iframe srcdoc="
                <html>
                <body style='padding:10px;font-family:Arial'>
                    <h3>Site Malicioso (simula√ß√£o)</h3>
                    <p>Este site cont√©m um formul√°rio oculto que tenta fazer uma transfer√™ncia banc√°ria sem seu conhecimento.</p>
                    <form id='maliciousForm' action='javascript:void(0)' method='POST'>
                        <input type='hidden' name='amount' value='5000'>
                        <input type='hidden' name='toAccount' value='99999-9'>
                    </form>
                    <script>
                        setTimeout(() => {
                            document.getElementById('maliciousForm').submit();
                            parent.document.getElementById('csrfResult').innerHTML = 
                                '&lt;p style=&quot;color:red;&quot;&gt;Ataque CSRF simulado: Requisi√ß√£o de transfer√™ncia de R$ 5000 enviada!&lt;/p&gt;';
                        }, 2000);
                    </script>
                </body>
                </html>
            "></iframe>
            
            <div id="csrfResult"></div>
            
            <p>Se o site banc√°rio n√£o tiver prote√ß√£o CSRF, essa transfer√™ncia seria realizada sem sua confirma√ß√£o!</p>
        </div>
    </div>
    
    <div class="secure">
        <h2>‚úÖ Cen√°rio Seguro (Com Tokens CSRF)</h2>
        <p>Com tokens CSRF, requisi√ß√µes n√£o podem ser feitas sem o token v√°lido.</p>
        
        <div class="demo-area">
            <h3>Como implementar:</h3>
            
            <p><strong>Backend (exemplo Node.js/Express com csrf middleware):</strong></p>
            <pre>
// Gerar token CSRF
app.use(csrf({ cookie: true }));

// Rota para formul√°rio - incluir token
app.get('/form', (req, res) => {
    res.render('form', { csrfToken: req.csrfToken() });
});

// Validar token em requisi√ß√µes POST
app.post('/transfer', (req, res) => {
    // O middleware csrf j√° valida automaticamente
    // Processar transfer√™ncia se token v√°lido
});</pre>

            <p><strong>Frontend (incluir token no formul√°rio):</strong></p>
            <pre>
&lt;form action="/transfer" method="POST"&gt;
    &lt;input type="hidden" name="_csrf" value="&lt;%= csrfToken %&gt;"&gt;
    &lt;!-- outros campos do formul√°rio --&gt;
&lt;/form&gt;</pre>
            
            <p>Resultado: O site malicioso n√£o pode gerar requisi√ß√µes v√°lidas sem conhecer o token CSRF.</p>
        </div>
    </div>
    
    <div class="explanation">
        <h2>üìö Explica√ß√£o</h2>
        <p><strong>Problema:</strong> Ataques CSRF permitem que um site malicioso fa√ßa requisi√ß√µes autenticadas em nome do usu√°rio, aproveitando que os cookies de sess√£o s√£o enviados automaticamente.</p>
        <p><strong>Solu√ß√£o:</strong> Tokens CSRF s√£o valores √∫nicos e secretos que devem ser inclu√≠dos em cada requisi√ß√£o que altera estado no servidor.</p>
        <p><strong>Responsabilidade:</strong></p>
        <ul>
            <li><strong>Desenvolvedor:</strong> Implementar gera√ß√£o e valida√ß√£o de tokens CSRF no backend e inclu√≠-los nos formul√°rios</li>
            <li><strong>Servidor:</strong> N√£o tem controle direto sobre essa prote√ß√£o</li>
        </ul>
    </div>

    <script>
        function simulateLogin() {
            document.getElementById('csrfResult').innerHTML = 
                "<p>Login simulado - cookies de sess√£o definidos. Agora voc√™ est√° 'autenticado'.</p>";
        }
    </script>
</body>
</html>